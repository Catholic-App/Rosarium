<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Terço Mariano - Rosarium</title>
<link rel="stylesheet" href="style.css">
<style>
  /* Ajustes locais de visual — mantêm estética Rosarium */
  :root{
    --primary:#4360C6;
    --bg:#FCFAFB;
    --text:#121212;
    --muted:#666;
    --icon:#4D3E43;
  }
  body{background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial;margin:0}
  .header{display:flex;align-items:center;padding:12px 16px;gap:.6rem}
  .btn-back{background:transparent;border:none;cursor:pointer;color:var(--text);font-size:1rem}
  .header-title{display:flex;align-items:center;gap:.6rem;font-weight:700}
  .page-container{max-width:760px;margin:1.25rem auto;padding:0 16px}
  .card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.04);margin-bottom:12px}
  .prayer-card{padding:14px}
  .prayer-card h3{margin:0 0 6px 0}
  .prayer-card p{margin:0;line-height:1.6}
  .misterio-box{background:#eef6ff;border-left:4px solid var(--primary);padding:10px;border-radius:8px;margin-bottom:12px;display:none}
  .counter{ text-align:center; padding:12px }
  .counter-display{ font-weight:700; font-size:1.6rem }
  .small-muted{ color:var(--muted); font-size:.95rem }

  .beads-container{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:12px 0}
  .bead{ display:inline-flex; align-items:center; justify-content:center; user-select:none; cursor:pointer; background:#fbfbfb; color:var(--icon); box-shadow:0 1px 3px rgba(0,0,0,0.04); }
  .bead.am{ width:34px; height:34px; border-radius:50%; font-weight:600 }       /* Ave Maria - menor */
  .bead.pn{ width:44px; height:44px; border-radius:50%; font-weight:700 }       /* Pai-Nosso - maior */
  .bead.filled{ background:var(--primary); color:#fff; box-shadow:0 6px 14px rgba(67,96,198,0.18) }

  .cross{ width:44px; height:44px; display:inline-flex;align-items:center;justify-content:center;border-radius:6px;background:#fff;color:var(--icon); box-shadow:0 1px 3px rgba(0,0,0,0.04); font-weight:700; }

  .progress-bar{height:8px;background:#eee;border-radius:999px;overflow:hidden;margin:8px 18px}
  .progress-fill{height:100%;width:0;background:var(--primary);transition:width .25s ease}
  .buttons{display:flex;gap:.6rem;justify-content:center;margin-top:8px;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:10px;border:none;background:var(--primary);color:#fff;cursor:pointer;font-weight:700}
  .btn-outline{background:transparent;border:1px solid #ddd;color:var(--text)}
  @media (max-width:420px){ .bead.am{width:30px;height:30px} .bead.pn{width:38px;height:38px} .cross{width:38px;height:38px} }
</style>
</head>
<body>
  <header class="header">
    <button class="btn-back" onclick="history.back()">← Voltar</button>
    <div class="header-title">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <span>Terço Mariano</span>
    </div>
  </header>

  <main class="page-container">
    <!-- Oração atual (card grande) -->
    <div class="card prayer-card" id="prayerCard">
      <h3 id="prayerTitle">Oração atual</h3>
      <p id="prayerText">Carregando...</p>
      <div class="small-muted" id="prayerMeta" style="margin-top:8px"></div>
    </div>

    <!-- Mistério (aparece só quando for PN) -->
    <div id="misterioBox" class="misterio-box">
      <strong id="misterioTitle"></strong>
      <div id="misterioText"></div>
    </div>

    <!-- Contador / Bolinhas -->
    <div class="card counter">
      <div id="counterDisplay" class="counter-display">0 / 0</div>
      <div class="small-muted" style="margin-bottom:8px">Progresso do Terço Mariano</div>

      <!-- Cruz do Credo (ícone) -->
      <div style="display:flex;justify-content:center;gap:8px;margin-bottom:12px">
        <div id="credoCross" class="cross" title="Creio" onclick="jumpToCreed()">✝</div>
      </div>

      <div id="beadsContainer" class="beads-container" aria-hidden="false"></div>

      <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
      <div id="progressLabel" class="small-muted" style="margin-top:6px">0%</div>

      <div class="buttons">
        <button class="btn" id="btnNext">+ Próxima</button>
        <button class="btn btn-outline" id="btnReset">Resetar</button>
      </div>
    </div>

  </main>

<script>
/* ----------------------------
   Dados / orações / mistérios
   ----------------------------*/
const ORACOES = {
  sinal_da_cruz: "Em nome do Pai, do Filho e do Espírito Santo. Amém.",
  credo: "Creio em Deus Pai todo-poderoso, criador do céu e da terra; e em Jesus Cristo, seu único Filho, nosso Senhor, ... Amém.",
  pai_nosso: "Pai nosso, que estais nos céus, santificado seja o vosso nome; venha a nós o vosso reino... Amém.",
  ave_maria: "Ave Maria, cheia de graça, o Senhor é convosco; bendita sois vós entre as mulheres, ... Amém.",
  gloria: "Glória ao Pai, e ao Filho, e ao Espírito Santo. Como era no princípio, agora e sempre. Amém.",
  salve_rainha: "Salve Rainha, Mãe de Misericórdia, vida, doçura e esperança nossa, salve; a vós bradamos, os degredados filhos de Eva..."
};

const MISTERIOS = {
  gozosos: [
    "1º Mistério Gozoso — Anunciação: O Anjo anuncia a Maria que será Mãe de Deus.",
    "2º Mistério Gozoso — Visitação: Maria visita Isabel.",
    "3º Mistério Gozoso — Nascimento: Jesus nasce em Belém.",
    "4º Mistério Gozoso — Apresentação: Jesus no Templo.",
    "5º Mistério Gozoso — Encontro no Templo."
  ],
  luminosos: [
    "1º Mistério Luminoso — Batismo no Jordão.",
    "2º Mistério Luminoso — Bodas de Caná.",
    "3º Mistério Luminoso — Anúncio do Reino.",
    "4º Mistério Luminoso — Transfiguração.",
    "5º Mistério Luminoso — Instituição da Eucaristia."
  ],
  dolorosos: [
    "1º Mistério Doloroso — Agonia no Horto.",
    "2º Mistério Doloroso — Flagelação.",
    "3º Mistério Doloroso — Coroação de Espinhos.",
    "4º Mistério Doloroso — Caminho do Calvário.",
    "5º Mistério Doloroso — Crucifixão."
  ],
  gloriosos: [
    "1º Mistério Glorioso — Ressurreição.",
    "2º Mistério Glorioso — Ascensão.",
    "3º Mistério Glorioso — Pentecostes.",
    "4º Mistério Glorioso — Assunção de Maria.",
    "5º Mistério Glorioso — Coroação de Maria."
  ]
};

/* ----------------------------
   Sequência (passos)
   - 'credo' (no ícone cruz)
   - 'pn' = Pai-Nosso
   - 'am' = Ave-Maria
   - 'gl' = Glória (não tem bead)
   - 'salve' = Salve Rainha (final)
   NOTE: beads serão geradas APENAS para 'pn' e 'am'
   ----------------------------*/
const SEQUENCE = (function(){
  const seq=[];
  // abertura: sinal/credo/pn + 3am + gl
  seq.push('sinal');        // optional: not shown as bead
  seq.push('credo');        // shown as cross icon, not bead
  seq.push('pn');           // PN inicial (bead pn)
  seq.push('am','am','am'); // 3 Ave-Marias iniciais  (beads am)
  seq.push('gl');           // Glória (no step but no bead)
  // 5 dezenas
  for(let d=0; d<5; d++){
    seq.push('pn');         // Pai-Nosso da dezena (bead pn)
    for(let i=0;i<10;i++) seq.push('am'); // 10 Ave-Marias (beads am)
    seq.push('gl');         // Glória (no step)
  }
  // final: Salve Rainha
  seq.push('salve');
  return seq;
})();

/* ----------------------------
   Mapeamento de mistérios por dia
   Domingo(0): Gloriosos
   Segunda(1): Gozosos
   Terça(2): Dolorosos
   Quarta(3): Gloriosos
   Quinta(4): Luminosos
   Sexta(5): Dolorosos
   Sábado(6): Gozosos
   ----------------------------*/
function getMisterioInfo(){
  const d = new Date().getDay();
  if (d===1||d===6) return {key:'gozosos', label:'Mistérios Gozosos'};
  if (d===2||d===5) return {key:'dolorosos', label:'Mistérios Dolorosos'};
  if (d===4) return {key:'luminosos', label:'Mistérios Luminosos'};
  return {key:'gloriosos', label:'Mistérios Gloriosos'};
}

/* ----------------------------
   Estado + Storage
   ----------------------------*/
const STORAGE_KEY = 'rosarium_terco_mariano_v2';
let state = { stepIndex: 0, pnCount: 0, amCount: 0 }; // pnCount counts PN encountered (0-based index for mysteries)
function loadState(){ try{ const raw = localStorage.getItem(STORAGE_KEY); if(raw) state = JSON.parse(raw); }catch(e){console.warn(e)} }
function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){console.warn(e)} }

/* ----------------------------
   Render UI
   ----------------------------*/
function render(){
  const step = SEQUENCE[state.stepIndex];
  const prayerTitle = document.getElementById('prayerTitle');
  const prayerText  = document.getElementById('prayerText');
  const prayerMeta  = document.getElementById('prayerMeta');
  const misterioBox  = document.getElementById('misterioBox');
  const misterioTitle = document.getElementById('misterioTitle');
  const misterioText  = document.getElementById('misterioText');

  // hide misterio by default
  misterioBox.style.display = 'none';
  misterioTitle.innerText = '';
  misterioText.innerText = '';

  // decide displayed prayer
  if(step==='sinal'){
    prayerTitle.innerText = 'Sinal da Cruz';
    prayerText.innerText = ORACOES.sinal_da_cruz;
    prayerMeta.innerText = '';
  } else if(step==='credo'){
    prayerTitle.innerText = 'Creio';
    prayerText.innerText = ORACOES.credo;
    prayerMeta.innerText = '';
  } else if(step==='pn'){
    prayerTitle.innerText = 'Pai-Nosso';
    prayerText.innerText = ORACOES.pai_nosso;
    const misterioInfo = getMisterioInfo();
    // show mystery corresponding to current pnCount (0-based)
    misterioBox.style.display = 'block';
    misterioTitle.innerText = `${misterioInfo.label} — ${Math.min(state.pnCount+1,5)}º`;
    misterioText.innerText = MISTERIOS[misterioInfo.key][ Math.min(state.pnCount,4) ];
    prayerMeta.innerText = `Pai-Nosso ${state.pnCount + 1} de ${5}`;
  } else if(step==='am'){
    prayerTitle.innerText = 'Ave-Maria';
    prayerText.innerText = ORACOES.ave_maria;
    prayerMeta.innerText = `Ave-Maria ${state.amCount} de 53`;
  } else if(step==='gl'){
    prayerTitle.innerText = 'Glória ao Pai';
    prayerText.innerText = ORACOES.gloria;
    prayerMeta.innerText = '';
    // hide mystery during Glória
    misterioBox.style.display = 'none';
  } else if(step==='salve'){
    prayerTitle.innerText = 'Salve Rainha';
    prayerText.innerText = ORACOES.salve_rainha;
    prayerMeta.innerText = '';
  } else {
    prayerTitle.innerText = '';
    prayerText.innerText = '';
    prayerMeta.innerText = '';
  }

  // counter display: show human-friendly step count
  document.getElementById('counterDisplay').innerText = `${state.stepIndex + 1} / ${SEQUENCE.length}`;

  // render beads: only for 'pn' and 'am'
  const container = document.getElementById('beadsContainer');
  container.innerHTML = '';
  // compute an array of bead steps with mapping to global step index
  const beadSteps = [];
  for(let i=0;i<SEQUENCE.length;i++){
    if(SEQUENCE[i]==='pn' || SEQUENCE[i]==='am'){
      beadSteps.push({ stepIndex:i, type: SEQUENCE[i] });
    }
  }
  beadSteps.forEach((b, idx)=>{
    const div = document.createElement('div');
    div.className = 'bead ' + (b.type==='pn' ? 'pn' : 'am');
    // determine filled state:
    // A bead is filled if its corresponding global step index is <= lastFilledStep
    // BUT special rule: when current step is 'gl', no new bead should be filled for that gl step.
    // We'll compute lastFilledStepIndex as the greatest global index <= state.stepIndex that is a 'pn' or 'am'
    let lastFilled = -1;
    for(let j=0;j<=state.stepIndex;j++){
      if(SEQUENCE[j]==='pn' || SEQUENCE[j]==='am') lastFilled = j;
    }
    // If current step is 'gl', we intentionally do not advance bead fill for the following PN until user clicks again.
    // lastFilled as computed above already follows that: when step is 'gl', lastFilled is previous pn/am (no extra)
    if(b.stepIndex <= lastFilled) div.classList.add('filled');
    div.textContent = (b.type==='pn' ? 'P' : idx+1); // small label: P for Pai-Nosso, number for am sequence (visual only)
    div.title = `${b.type.toUpperCase()} - passo ${b.stepIndex+1}`;
    div.onclick = ()=> jumpTo(b.stepIndex);
    container.appendChild(div);
  });

  // progress based on sequence index (not bead index)
  const pct = Math.round(((state.stepIndex + 1) / SEQUENCE.length) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressLabel').innerText = pct + '%';
}

/* ----------------------------
   Controle: next / reset / jump
   Behavior important: when hitting a 'gl' step, we DO NOT fill a bead on that click
   only when moving into the next PN or AM bead step will bead fill update
   ----------------------------*/
function next(){
  if(state.stepIndex >= SEQUENCE.length -1){
    alert('Terço completo — Glória a Deus!');
    return;
  }
  state.stepIndex++;
  const cur = SEQUENCE[state.stepIndex];

  if(cur === 'pn'){
    // entering a PN: increment PN counter (used to index mystery)
    state.pnCount = Math.min(state.pnCount + 1, 4);
  } else if(cur === 'am'){
    // entering an Ave-Maria: increment amCount
    state.amCount = Math.min(state.amCount + 1, 53);
  } else if(cur === 'gl'){
    // entering glória: do NOT change bead fill — handled by render logic
    // no counters change needed
  } else if(cur === 'salve'){
    // final
  }
  saveState();
  render();
}

function reset(){
  if(!confirm('Deseja resetar o Terço Mariano?')) return;
  state = { stepIndex:0, pnCount:0, amCount:0 };
  saveState();
  render();
}

// jump to arbitrary global step index (used by beads)
function jumpTo(globalStepIndex){
  if(globalStepIndex<0 || globalStepIndex>=SEQUENCE.length) return;
  // recompute pnCount and amCount up to that index
  let pn=0, am=0;
  for(let i=0;i<=globalStepIndex;i++){
    if(SEQUENCE[i]==='pn') pn++;
    if(SEQUENCE[i]==='am') am++;
  }
  state.stepIndex = globalStepIndex;
  state.pnCount = Math.max(0,pn-1); // pnCount is 0-based index for mysteries (pn encountered minus one if currently on pn)
  state.amCount = am;
  saveState();
  render();
}
function jumpToCreed(){ jumpTo( SEQUENCE.indexOf('credo') ); }

document.addEventListener('DOMContentLoaded',()=>{
  loadState();
  // normalize
  if(typeof state.stepIndex!=='number' || state.stepIndex<0 || state.stepIndex>=SEQUENCE.length) state.stepIndex = 0;
  render();
  document.getElementById('btnNext').addEventListener('click', next);
  document.getElementById('btnReset').addEventListener('click', reset);
  // allow clicking cross to jump to creed (already wired)
});
</script>
</body>
</html>